<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Dashboard</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            padding: 0;
        }

        .sticky-header {
            position: sticky;
            top: 0;
            background-color: #f5f5f5;
            z-index: 100;
            padding: 20px 20px 0;
        }

        .column-headers {
            display: table;
            table-layout: fixed;
            margin: 0 auto;
        }

        .col-header {
            display: table-cell;
            background-color: #667eea;
            color: white;
            font-weight: 600;
            font-size: 14px;
            padding: 8px;
            text-align: center;
            border: 1px solid #5a6fd6;
            width: 120px;
            max-width: 120px;
        }

        .col-header.col-mission {
            text-align: left;
            width: 340px;
            min-width: 340px;
        }

        .hidden-thead {
            visibility: collapse;
            height: 0;
        }

        .hidden-thead th {
            padding: 0;
            border: none;
            height: 0;
            line-height: 0;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .dashboard-container {
            margin: 0 auto;
            padding: 0 20px 40px;
            width: fit-content;
        }

        table {
            width: auto;
            table-layout: fixed;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        th, td {
            border: 1px solid #ddd;
            border-top: none;
            padding: 8px;
            text-align: center;
        }

        /* Level columns - fixed width */
        td:not(:first-child) {
            width: 120px;
            max-width: 120px;
        }

        thead tr:first-child th {
            border-top: 1px solid #ddd;
        }

        th {
            background-color: #667eea;
            color: white;
            font-weight: 600;
            font-size: 14px;
            position: sticky;
            top: 80px;
            z-index: 50;
        }

        th.level-header {
            width: 120px;
            max-width: 120px;
        }

        /* Row hierarchy styling */
        .realm-row {
            background-color: #e8eaf6;
            font-weight: 600;
            font-size: 14px;
        }

        .realm-row td {
            background-color: #e8eaf6;
        }

        .realm-row td:first-child {
            text-align: left;
            padding-left: 10px;
        }
        
        /* Sticky realm indicator */
        .sticky-realm-indicator {
            position: fixed;
            top: 175px;
            background-color: #e8eaf6;
            padding: 8px 10px;
            font-weight: 600;
            font-size: 14px;
            z-index: 95;
            display: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: left;
        }
        
        .sticky-realm-indicator.visible {
            display: block;
        }
        
        /* Hide mobile table header on desktop/tablet */
        .mobile-table-header {
            display: none;
        }

        .mission-row td:first-child {
            text-align: left;
            padding-left: 10px;
            font-size: 13px;
        }

        .mission-row td:first-child > div {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }


        /* Hide launch buttons - mission cells are now clickable */
        .launch-btn {
            display: none;
        }
        
        /* Style mission cells as clickable buttons */
        .mission-row td:first-child {
            cursor: pointer;
        }
        
        .mission-row td:first-child > div {
            background: linear-gradient(135deg, #667eea 0%, #5c6bc0 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }
        
        .mission-row td:first-child > div:hover {
            background: linear-gradient(135deg, #5a6fd6 0%, #4a5ab0 100%);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
            transform: translateY(-1px);
        }
        
        .mission-row td:first-child > div:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(102, 126, 234, 0.3);
        }
        
        .mission-name {
            flex: 1;
            color: white;
            font-weight: 600;
        }

        /* Pundex cell container */
        .pundex-cell {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            padding: 4px;
            min-height: 28px;
        }

        /* Individual pundex indicator */
        .pundex {
            width: 100%;
            height: 20px;
            border-radius: 3px;
            background-color: #e0e0e0;
            border: 1px dashed #bbb;
        }

        .pundex.completed {
            border: none;
        }

        /* Pundex colors matching index.html power meter - only applied when completed */
        .pundex.ignition.completed {
            background-color: #e53935;
        }

        .pundex.charging.completed {
            background-color: #ffb300;
        }

        .pundex.ready.completed {
            background-color: #43a047;
        }

        .pundex.power-up.completed {
            background-color: #8e24aa;
        }

        /* Unavailable level (no modules) */
        td:has(.pundex-cell.unavailable) {
            background-color: #f0f0f0;
        }

        .pundex-cell.unavailable {
            position: relative;
        }

        .pundex-cell.unavailable .pundex {
            visibility: hidden;
        }

        .pundex-cell.unavailable::after {
            content: "‚Äî";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #bbb;
            font-size: 18px;
        }

        /* Tooltip styling */
        .pundex-cell {
            position: relative;
            cursor: default;
        }

        .pundex-cell.current-level {
            cursor: pointer;
        }

        /* Tooltip container - created by JavaScript */
        .tooltip {
            position: fixed;
            background-color: #333;
            color: white;
            padding: 8px 10px;
            border-radius: 6px;
            font-size: 11px;
            white-space: pre-line;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            line-height: 1.4;
            text-align: left;
            pointer-events: none;
            max-width: 250px;
        }

        .tooltip::after {
            content: "";
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
        }

        .tooltip.above::after {
            top: 100%;
            border-top-color: #333;
        }

        .tooltip.below::after {
            bottom: 100%;
            border-bottom-color: #333;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #555;
        }

        .legend-color {
            width: 20px;
            height: 14px;
            border-radius: 3px;
        }

        /* Key Modal */
        .key-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .key-modal-overlay.open {
            display: flex;
        }
        
        .key-modal {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 320px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .key-modal h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #333;
            text-align: center;
        }
        
        .key-modal .legend {
            display: flex !important;
            flex-direction: column;
            gap: 10px;
            margin: 0;
        }
        
        .key-modal .legend-item {
            font-size: 14px;
        }
        
        .key-modal .legend-color {
            width: 24px;
            height: 18px;
        }
        
        .key-modal-close {
            display: block;
            width: 100%;
            margin-top: 15px;
            padding: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        /* Mobile styles */
        @media (max-width: 767px) {
            .launch-btn {
                display: none !important;
            }
            
            .mission-row td:first-child {
                cursor: pointer;
            }
            
            .mission-row td:first-child:hover {
                background-color: rgba(92, 107, 192, 0.1);
            }
            
            .mission-row td:first-child > div {
                position: relative;
            }
            
            /* Mobile sticky table header */
            .mobile-table-header {
                display: flex !important;
                position: fixed;
                top: 80px;
                left: 10px;
                right: 10px;
                z-index: 150;
                background-color: #667eea;
                border-radius: 4px 4px 0 0;
                height: 26px;
                line-height: 26px;
            }
            
            .mobile-header-cell {
                flex: 1;
                display: flex !important;
                align-items: center;
                justify-content: center;
                padding: 0 4px;
                color: white;
                font-weight: 600;
                font-size: 11px;
                border-right: 1px solid #5a6fd6;
                height: 26px;
            }
            
            .mobile-header-cell:last-child {
                border-right: none;
            }
            
            .mobile-header-cell.mission-col {
                flex: 2.5;
                justify-content: flex-start;
                padding-left: 10px;
            }
            
            .mobile-header-cell.level-header {
                flex: 1;
            }
            
            /* Hide the table's thead on mobile - use fixed header instead */
            .hidden-thead {
                display: none !important;
            }
            
            .hidden-thead th:first-child {
                text-align: left !important;
                padding-left: 10px !important;
                border-radius: 4px 0 0 0;
                width: 40% !important;
            }
            
            .hidden-thead th:nth-child(2),
            .hidden-thead th:nth-child(3),
            .hidden-thead th:nth-child(4) {
                width: 20% !important;
            }
            
            .hidden-thead th:nth-child(4) {
                border-radius: 0 4px 0 0;
            }
            
            /* Hide level 4, 5, 6 columns in thead */
            .hidden-thead th:nth-child(5),
            .hidden-thead th:nth-child(6),
            .hidden-thead th:nth-child(7) {
                display: none !important;
            }
            
            /* Show the separate mobile header */
            .mobile-table-header {
                display: flex !important;
                position: fixed;
                top: 80px;
                left: 10px;
                right: 10px;
                z-index: 500;
                background-color: #667eea;
                border-radius: 4px 4px 0 0;
                height: 30px;
            }
            
            .mobile-header-cell {
                display: flex !important;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 600;
                font-size: 12px;
                border-right: 1px solid #5a6fd6;
            }
            
            .mobile-header-cell:last-child {
                border-right: none;
            }
            
            .mobile-header-cell.mission-col {
                width: 40%;
                flex: none;
                justify-content: flex-start;
                padding-left: 10px;
            }
            
            .mobile-header-cell.level-header {
                width: 20%;
                flex: none;
            }
            
            /* Mobile: Card-based layout */
            .column-headers {
                display: none !important;
            }
            
            .dashboard-container {
                padding: 0 10px 40px;
                padding-top: 30px;
                margin-top: 0;
                position: relative;
                z-index: 1;
            }
            
            table {
                display: table;
                width: 100%;
            }
            
            .sticky-header {
                padding: 10px 10px 5px;
                z-index: 200;
                background-color: #f5f5f5;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
            }
            
            .sticky-header h1 {
                font-size: 20px;
                text-align: left;
                padding-right: 60px;
                line-height: 36px;
                min-height: 36px;
            }
            
            #userHeaderContainer {
                top: 10px !important;
            }
            
            .subtitle {
                font-size: 12px;
                margin-bottom: 10px;
            }
            
            .legend {
                display: none !important;
            }
            
            table {
                display: table;
                width: 100%;
                table-layout: fixed;
            }
            
            /* Hide colgroup entirely on mobile */
            colgroup {
                display: table-column-group;
            }
            
            /* Set column widths via colgroup */
            colgroup col:nth-child(1) {
                width: 40% !important;
            }
            
            colgroup col:nth-child(2),
            colgroup col:nth-child(3),
            colgroup col:nth-child(4) {
                width: 20% !important;
            }
            
            colgroup col:nth-child(n+5) {
                width: 0 !important;
                visibility: collapse !important;
            }
            
            tbody {
                display: table-row-group;
            }
            
            /* Realm rows on mobile - sticky below fixed header */
            .realm-row {
                display: table-row;
                background-color: #e8eaf6 !important;
                position: sticky;
                top: 110px;
                z-index: 50;
            }
            
            /* First realm row should be at top initially */
            .realm-row:first-of-type {
                margin-top: 0;
            }
            
            .realm-row td {
                display: table-cell;
                padding: 8px 10px !important;
                border: none !important;
                background-color: #e8eaf6 !important;
                font-weight: 600;
            }
            
            .realm-row td:first-child {
                display: table-cell;
                width: 40% !important;
            }
            
            .realm-row td:nth-child(2),
            .realm-row td:nth-child(3),
            .realm-row td:nth-child(4) {
                display: table-cell;
                width: 20% !important;
            }
            
            .realm-row td:nth-child(n+5) {
                display: none !important;
                width: 0 !important;
                max-width: 0 !important;
                padding: 0 !important;
                border: none !important;
                overflow: hidden !important;
            }
            
            /* Hide sticky realm indicator on mobile - realm rows visible in table */
            .sticky-realm-indicator {
                display: none !important;
            }
            
            /* Mission rows as table rows on mobile */
            .mission-row {
                display: table-row;
                background: white;
            }
            
            .mission-row td {
                display: table-cell;
                border: 1px solid #e0e0e0 !important;
                padding: 6px 4px !important;
                vertical-align: middle;
            }
            
            .mission-row td:first-child {
                font-weight: 600;
                font-size: 12px;
                width: 40% !important;
            }
            
            .mission-row td:nth-child(2),
            .mission-row td:nth-child(3),
            .mission-row td:nth-child(4) {
                width: 20% !important;
            }
            
            .mission-row td:first-child > div::after {
                right: 0;
            }
            
            .mission-row td:not(:first-child) {
                text-align: center;
            }
            
            /* Pundex cells in mobile */
            .pundex-cell {
                grid-template-columns: repeat(4, 1fr);
                gap: 1px;
                padding: 2px;
                min-height: 20px;
            }
            
            .pundex {
                width: 100%;
                height: 16px;
                border-radius: 2px;
            }
            
            /* Mobile: Hide colgroup columns 5, 6, 7 (Level 4, 5, 6) */
            colgroup col:nth-child(5),
            colgroup col:nth-child(6),
            colgroup col:nth-child(7) {
                width: 0 !important;
            }
            
            /* Mobile: Hide Level 4, 5, 6 columns (nth-child 5, 6, 7) */
            .mission-row td:nth-child(n+5) {
                display: none !important;
                width: 0 !important;
                max-width: 0 !important;
                padding: 0 !important;
                border: none !important;
                overflow: hidden !important;
            }
            
            /* Mobile table layout */
            table {
                table-layout: fixed !important;
                width: calc(100% - 20px) !important;
            }
            
            /* Mobile column widths - 4 columns only */
            .mission-row td:first-child,
            .realm-row td:first-child {
                width: 40% !important;
            }
            
            .mission-row td:nth-child(2),
            .mission-row td:nth-child(3),
            .mission-row td:nth-child(4),
            .realm-row td:nth-child(2),
            .realm-row td:nth-child(3),
            .realm-row td:nth-child(4) {
                width: 20% !important;
            }
            
        }

    </style>
</head>
<body>

    <div class="sticky-header">
        <h1>üìä Progress Dashboard</h1>
        <p class="subtitle">Track your mastery across all Worlds, Realms, and Missions</p>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f0f0f0; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; color: #ccc; font-size: 10px;">‚Äî</div>
                <span>No Modules</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e0e0e0; border: 1px dashed #bbb;"></div>
                <span>Not Started</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e53935;"></div>
                <span>Ignition</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ffb300;"></div>
                <span>Charging</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #43a047;"></div>
                <span>Ready</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #8e24aa;"></div>
                <span>Power Up</span>
            </div>
        </div>
        <div class="column-headers">
            <div class="col-header col-mission">World / Realm / Mission</div>
            <div class="col-header">Level 1</div>
            <div class="col-header">Level 2</div>
            <div class="col-header">Level 3</div>
            <div class="col-header">Level 4</div>
            <div class="col-header">Level 5</div>
            <div class="col-header">Level 6</div>
        </div>
    </div>

    <!-- Sticky realm indicator -->
    <div class="sticky-realm-indicator" id="stickyRealmIndicator"></div>

    <!-- Mobile sticky table header -->
    <div class="mobile-table-header" id="mobileTableHeader">
        <div class="mobile-header-cell mission-col">Mission</div>
        <div class="mobile-header-cell level-header" data-level="1">L1</div>
        <div class="mobile-header-cell level-header" data-level="2">L2</div>
        <div class="mobile-header-cell level-header" data-level="3">L3</div>
    </div>

    <div class="dashboard-container">
        <table>
            <colgroup>
                <col style="width: 340px;">
                <col>
                <col>
                <col>
                <col>
                <col>
                <col>
            </colgroup>
            <thead class="hidden-thead">
                <tr>
                    <th>World / Realm / Mission</th>
                    <th>Level 1</th>
                    <th>Level 2</th>
                    <th>Level 3</th>
                    <th>Level 4</th>
                    <th>Level 5</th>
                    <th>Level 6</th>
                </tr>
            </thead>
            <tbody>
                <!-- Realm: Number > Place Value -->
                <tr class="realm-row">
                    <td colspan="7">üî¢ Number > üìç Place Value</td>
                </tr>
                <tr class="mission-row">
                    <td>Counting</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Comparing Numbers</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Identifying, Representing & Estimating</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Reading and Writing Numbers</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Place Value</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Rounding</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Problem Solving (PV)</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>

                <!-- Realm: Number > Addition and Subtraction -->
                <tr class="realm-row">
                    <td colspan="7">üî¢ Number > ‚ûï Addition and Subtraction</td>
                </tr>
                <tr class="mission-row">
                    <td>Number Bonds</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Mental Calculation (A&S)</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Written Methods</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Inverse Operations & Checking (A&S)</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Problem Solving (A&S)</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>

                <!-- Realm: Number > Multiplication and Division -->
                <tr class="realm-row">
                    <td colspan="7">üî¢ Number > ‚úñÔ∏è Multiplication and Division</td>
                </tr>
                <tr class="mission-row">
                    <td>Multiplication & Division Facts</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Mental Calculation (M&D)</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Written Calculation (M&D)</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Properties of Numbers</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Order of Operations</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Inverse Operations & Checking</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Problem Solving (M&D)</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>

                <!-- Realm: Number > Fractions, Decimals and Percentages -->
                <tr class="realm-row">
                    <td colspan="7">üî¢ Number > üî¢ Fractions, Decimals and Percentages</td>
                </tr>
                <tr class="mission-row">
                    <td>Counting in Fractional Steps</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Recognising Fractions</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Comparing Fractions</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Comparing Decimals</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Rounding Including Decimals</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Equivalence (FDP)</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Add & Subtract Fractions</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Multiply & Divide Fractions</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Multiply & Divide Decimals</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Problem Solving (FDP)</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>

                <!-- Realm: Algebra (no sub-realms) -->
                <tr class="realm-row">
                    <td colspan="7">üî§ Algebra</td>
                </tr>
                <tr class="mission-row">
                    <td>Equations</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Formulae</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Sequences</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>

                <!-- Realm: Measurement (no sub-realms) -->
                <tr class="realm-row">
                    <td colspan="7">üìè Measurement</td>
                </tr>
                <tr class="mission-row">
                    <td>Comparing and Estimating</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Measuring and Calculating</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Telling the Time</td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Converting</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>

                <!-- Realm: Geometry > Properties of Shapes -->
                <tr class="realm-row">
                    <td colspan="7">üìê Geometry > üî∑ Properties of Shapes</td>
                </tr>
                <tr class="mission-row">
                    <td>Identifying Shapes & Properties</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Drawing and Constructing</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Comparing and Classifying</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Angles</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <!-- Realm: Geometry > Position and Direction -->
                <tr class="realm-row">
                    <td colspan="7">üìê Geometry > üß≠ Position and Direction</td>
                </tr>
                <tr class="mission-row">
                    <td>Position, Direction & Movement</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Pattern</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>

                <!-- Realm: Ratio and Proportion (no sub-realms) -->
                <tr class="realm-row">
                    <td colspan="7">‚öñÔ∏è Ratio and Proportion</td>
                </tr>
                <tr class="mission-row">
                    <td>Ratio and Proportion</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>

                <!-- Realm: Statistics (no sub-realms) -->
                <tr class="realm-row">
                    <td colspan="7">üìà Statistics</td>
                </tr>
                <tr class="mission-row">
                    <td>Interpreting, Constructing & Presenting Data</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
                <tr class="mission-row">
                    <td>Solving Problems</td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell unavailable"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                    <td><div class="pundex-cell"><div class="pundex ignition"></div><div class="pundex charging"></div><div class="pundex ready"></div><div class="pundex power-up"></div></div></td>
                </tr>
            </tbody>
        </table>
    </div>


    <!-- Key Modal -->
    <div class="key-modal-overlay" id="keyModalOverlay">
        <div class="key-modal">
            <h3>üîë Key</h3>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f0f0f0; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; color: #ccc; font-size: 10px;">‚Äî</div>
                    <span>No Modules</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e0e0e0; border: 1px dashed #bbb;"></div>
                    <span>Not Started</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e53935;"></div>
                    <span>Ignition</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffb300;"></div>
                    <span>Charging</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #43a047;"></div>
                    <span>Ready</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #8e24aa;"></div>
                    <span>Power Up</span>
                </div>
            </div>
            <button class="key-modal-close" id="keyModalClose">Close</button>
        </div>
    </div>

    <!-- User Header -->
    <div id="userHeaderContainer" style="position: fixed; top: 10px; right: 10px; z-index: 1000;"></div>

    <script src="user-auth.js"></script>
    <script>
        // Require login
        const currentUser = UserAuth.requireLogin();
        if (!currentUser) {
            // Will redirect to login
            throw new Error('Not logged in');
        }

        // Add user header
        document.addEventListener('DOMContentLoaded', () => {
            const headerContainer = document.getElementById('userHeaderContainer');
            const userHeader = UserAuth.createUserHeader();
            if (userHeader) {
                headerContainer.appendChild(userHeader);
                // Hide Progress button since we're already on the Progress page
                const dropdownBtns = headerContainer.querySelectorAll('.user-header-dropdown-btn');
                dropdownBtns.forEach(btn => {
                    if (btn.textContent.includes('Progress')) {
                        btn.style.display = 'none';
                    }
                });
                
                // Show and wire up Key button on mobile
                if (window.innerWidth <= 767) {
                    const keyBtn = headerContainer.querySelector('#menuKeyBtn');
                    if (keyBtn) {
                        keyBtn.style.display = 'flex';
                        keyBtn.addEventListener('click', () => {
                            document.getElementById('keyModalOverlay').classList.add('open');
                            // Close the dropdown
                            headerContainer.querySelector('.user-header-dropdown').classList.remove('open');
                        });
                    }
                }
            }
            
            // Key modal close handlers
            document.getElementById('keyModalClose').addEventListener('click', () => {
                document.getElementById('keyModalOverlay').classList.remove('open');
            });
            
            document.getElementById('keyModalOverlay').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    e.currentTarget.classList.remove('open');
                }
            });
        });

        // Pundex tier mapping
        const pundexTiers = ['Beginning', 'Developing', 'Meeting', 'Exceeding'];
        const pundexClasses = ['ignition', 'charging', 'ready', 'power-up'];

        // Apply user progress to the dashboard
        function applyUserProgress() {
            document.querySelectorAll('.mission-row').forEach(row => {
                const firstCell = row.querySelector('td:first-child');
                // Get mission name - handle both plain text and wrapped in span
                const missionSpan = firstCell.querySelector('.mission-name');
                const missionName = missionSpan ? missionSpan.textContent.trim() : firstCell.textContent.trim();
                const cells = row.querySelectorAll('.pundex-cell');

                cells.forEach((cell, index) => {
                    const level = index + 1;
                    
                    // Skip unavailable cells
                    if (cell.classList.contains('unavailable')) return;

                    // Get user progress for this mission/level
                    const levelProgress = UserAuth.getProgress(missionName, level);
                    
                    // Apply completed status to each pundex
                    const pundexElements = cell.querySelectorAll('.pundex');
                    pundexElements.forEach((pundexEl, pundexIdx) => {
                        const tierName = pundexTiers[pundexIdx];
                        const isCompleted = levelProgress?.pundexCompleted?.[tierName]?.completed;
                        
                        // Remove any existing completed class first
                        pundexEl.classList.remove('completed');
                        
                        if (isCompleted) {
                            pundexEl.classList.add('completed');
                        }
                    });
                });
            });
        }

        // Module data from CSV - mission/level -> array of module descriptions
        const moduleData = {
            "Counting": {
                1: ["count to and across 100, forwards and backwards, beginning with 0 or 1, or from any given number", "count, read and write numbers to 100 in numerals; count in multiples of twos, fives and tens", "given a number, identify one more and one less"],
                2: ["count in steps of 2, 3, and 5 from 0, and in tens from any number, forward or backward"],
                3: ["count from 0 in multiples of 4, 8, 50 and 100", "find 10 or 100 more or less than a given number"],
                4: ["count backwards through zero to include negative numbers", "count in multiples of 6, 7, 9, 25 and 1000", "find 1000 more or less than a given number"],
                5: ["interpret negative numbers in context, count forwards and backwards with positive and negative whole numbers, including through zero", "count forwards or backwards in steps of powers of 10 for any given number up to 1000000"],
                6: ["use negative numbers in context, and calculate intervals across zero"]
            },
            "Comparing Numbers": {
                1: ["use the language of: equal to, more than, less than (fewer), most, least"],
                2: ["compare and order numbers from 0 up to 100; use <, > and = signs"],
                3: ["compare and order numbers up to 1000"],
                4: ["order and compare numbers beyond 1000", "compare numbers with the same number of decimal places up to two decimal places"],
                5: ["read, write, order and compare numbers to at least 1 000 000 and determine the value of each digit"],
                6: ["read, write, order and compare numbers up to 10 000 000 and determine the value of each digit"]
            },
            "Identifying, Representing & Estimating": {
                1: ["Identify and represent numbers to 20 using objects and pictorial representations, and reason about their location on a number line."],
                2: ["Identify, represent, and estimate two-digit numbers using different representations, and reason about their location on a 0-100 number line."],
                3: ["Identify, represent, and estimate three-digit numbers using different representations, and reason about their location on a 0-1000 number line."],
                4: ["Identify, represent, and estimate four-digit numbers using different representations, and reason about their location in the linear number system."]
            },
            "Reading and Writing Numbers": {
                1: ["read and write numbers from 1 to 20 in numerals and words."],
                2: ["read and write numbers to at least 100 in numerals and in words"],
                3: ["read and write numbers up to 1000 in numerals and in words", "tell and write the time from an analogue clock, including using Roman numerals from I to XII"],
                4: ["read Roman numerals to 100 (I to C) and know that over time, the numeral system changed to include the concept of zero and place value."],
                5: ["read, write, order and compare numbers to at least 1 000 000 and determine the value of each digit", "read Roman numerals to 1000 (M) and recognise years written in Roman numerals."],
                6: ["read, write, order and compare numbers up to 10 000 000 and determine the value of each digit"]
            },
            "Place Value": {
                2: ["recognise the place value of each digit in a two-digit number (tens, ones)"],
                3: ["recognise the place value of each digit in a three-digit number (hundreds, tens, ones)"],
                4: ["recognise the place value of each digit in a four-digit number (thousands, hundreds, tens, and ones)", "find the effect of dividing a one- or two-digit number by 10 and 100"],
                5: ["read, write, order and compare numbers to at least 1 000 000 and determine the value of each digit", "recognise and use thousandths and relate them to tenths, hundredths and decimal equivalents"],
                6: ["read, write, order and compare numbers up to 10 000 000 and determine the value of each digit", "identify the value of each digit to three decimal places and multiply and divide numbers by 10, 100 and 1000"]
            },
            "Rounding": {
                4: ["round any number to the nearest 10, 100 or 1000", "round decimals with one decimal place to the nearest whole number"],
                5: ["round any number up to 1 000 000 to the nearest 10, 100, 1000, 10 000 and 100 000", "round decimals with two decimal places to the nearest whole number and to one decimal place"],
                6: ["round any whole number to a required degree of accuracy", "solve problems which require answers to be rounded to specified degrees of accuracy"]
            },
            "Problem Solving (PV)": {
                2: ["use place value and number facts to solve problems"],
                3: ["solve number problems and practical problems involving these ideas."],
                4: ["solve number problems and practical problems that involve all of the above and with increasingly large positive numbers"],
                5: ["solve number problems and practical problems that involve all of the above"],
                6: ["solve number and practical problems that involve all of the above"]
            },
            "Number Bonds": {
                1: ["represent and use number bonds and related subtraction facts within 20"],
                2: ["recall and use addition and subtraction facts to 20 fluently, and derive and use related facts up to 100"]
            },
            "Mental Calculation (A&S)": {
                1: ["add and subtract one-digit and two-digit numbers to 20, including zero", "read, write and interpret mathematical statements involving addition (+), subtraction (-) and equals (=) signs"],
                2: ["add and subtract numbers using concrete objects, pictorial representations, and mentally", "show that addition of two numbers can be done in any order (commutative)"],
                3: ["add and subtract numbers mentally, including: a three-digit number and ones, tens, hundreds"],
                4: ["add and subtract numbers mentally with increasingly large numbers"],
                5: ["add and subtract whole numbers with more than 4 digits, including using formal written methods"],
                6: ["perform mental calculations, including with mixed operations and large numbers", "use their knowledge of the order of operations to carry out calculations"]
            },
            "Written Methods": {
                1: ["read, write and interpret mathematical statements involving addition (+), subtraction (-) and equals (=) signs"],
                3: ["add and subtract numbers with up to three digits, using formal written methods of columnar addition and subtraction"],
                4: ["add and subtract numbers with up to 4 digits using the formal written methods of columnar addition and subtraction"],
                5: ["add and subtract whole numbers with more than 4 digits, including using formal written methods (columnar addition and subtraction)"]
            },
            "Inverse Operations & Checking (A&S)": {
                2: ["recognise and use the inverse relationship between addition and subtraction and use this to check calculations"],
                3: ["estimate the answer to a calculation and use inverse operations to check answers"],
                4: ["estimate and use inverse operations to check answers to a calculation"],
                5: ["use rounding to check answers to calculations and determine levels of accuracy"],
                6: ["use estimation to check answers to calculations and determine levels of accuracy."]
            },
            "Problem Solving (A&S)": {
                1: ["solve one-step problems that involve addition and subtraction, using concrete objects and pictorial representations"],
                2: ["solve problems with addition and subtraction using concrete objects and pictorial representations", "solve simple problems involving addition and subtraction of money"],
                3: ["solve problems, including missing number problems, using number facts, place value, and more complex addition and subtraction"],
                4: ["solve addition and subtraction two-step problems in contexts"],
                5: ["solve addition and subtraction multi-step problems in contexts"],
                6: ["solve addition and subtraction multi-step problems in contexts", "solve problems involving addition, subtraction, multiplication and division"]
            },
            "Multiplication & Division Facts": {
                1: ["count in multiples of twos, fives and tens"],
                2: ["count in steps of 2, 3, and 5 from 0", "recall and use multiplication and division facts for the 2, 5 and 10 multiplication tables"],
                3: ["count from 0 in multiples of 4, 8, 50 and 100", "recall and use multiplication and division facts for the 3, 4 and 8 multiplication tables"],
                4: ["count in multiples of 6, 7, 9, 25 and 1000", "recall multiplication and division facts for multiplication tables up to 12 x 12"],
                5: ["count forwards or backwards in steps of powers of 10 for any given number up to 1 000 000"]
            },
            "Mental Calculation (M&D)": {
                2: ["show that multiplication of two numbers can be done in any order (commutative)"],
                3: ["write and calculate mathematical statements for multiplication and division using the multiplication tables"],
                4: ["use place value, known and derived facts to multiply and divide mentally", "recognise and use factor pairs and commutativity"],
                5: ["multiply and divide numbers mentally drawing upon known facts", "multiply and divide whole numbers by 10, 100 and 1000"],
                6: ["perform mental calculations, including with mixed operations and large numbers", "associate a fraction with division and calculate decimal fraction equivalents"]
            },
            "Written Calculation (M&D)": {
                2: ["calculate mathematical statements for multiplication and division within the multiplication tables"],
                3: ["write and calculate mathematical statements for multiplication and division using formal written methods"],
                4: ["multiply two-digit and three-digit numbers by a one-digit number using formal written layout"],
                5: ["multiply numbers up to 4 digits by a one- or two-digit number using formal written method", "divide numbers up to 4 digits by a one-digit number using short division"],
                6: ["multiply multi-digit numbers up to 4 digits by a two-digit whole number using long multiplication", "divide numbers up to 4-digits by a two-digit whole number using long division", "use written division methods where the answer has up to two decimal places"]
            },
            "Properties of Numbers": {
                4: ["recognise and use factor pairs and commutativity in mental calculations"],
                5: ["identify multiples and factors, including finding all factor pairs", "know and use the vocabulary of prime numbers, prime factors and composite numbers", "establish whether a number up to 100 is prime", "recognise and use square numbers and cube numbers"],
                6: ["identify common factors, common multiples and prime numbers", "use common factors to simplify fractions", "calculate, estimate and compare volume of cubes and cuboids"]
            },
            "Order of Operations": {
                6: ["use their knowledge of the order of operations to carry out calculations involving the four operations"]
            },
            "Inverse Operations & Checking": {
                3: ["estimate the answer to a calculation and use inverse operations to check answers"],
                4: ["estimate and use inverse operations to check answers to a calculation"],
                5: ["use rounding to check answers to calculations and determine levels of accuracy"],
                6: ["use estimation to check answers to calculations and determine levels of accuracy"]
            },
            "Problem Solving (M&D)": {
                1: ["solve one-step problems involving multiplication and division, using concrete objects and arrays"],
                2: ["solve problems involving multiplication and division, using materials, arrays, repeated addition"],
                3: ["solve problems, including missing number problems, involving multiplication and division"],
                4: ["solve problems involving multiplying and adding, including using the distributive law"],
                5: ["solve problems involving multiplication and division including factors, multiples, squares and cubes", "solve problems involving addition, subtraction, multiplication and division", "solve problems involving scaling by simple fractions"],
                6: ["solve problems involving addition, subtraction, multiplication and division", "solve problems involving similar shapes where the scale factor is known"]
            },
            "Counting in Fractional Steps": {
                2: ["count in fractions up to 10, starting from any number and using the 1/2 and 2/4 equivalence"],
                3: ["count up and down in tenths"],
                4: ["count up and down in hundredths"]
            },
            "Recognising Fractions": {
                1: ["recognise, find and name a half as one of two equal parts", "recognise, find and name a quarter as one of four equal parts"],
                2: ["recognise, find, name and write fractions 1/3, 1/4, 2/4 and 3/4 of a length, shape, set of objects"],
                3: ["recognise, find and write fractions of a discrete set of objects", "recognise that tenths arise from dividing an object into 10 equal parts", "recognise and use fractions as numbers"],
                4: ["recognise that hundredths arise when dividing an object by one hundred"],
                5: ["recognise and use thousandths and relate them to tenths, hundredths and decimal equivalents"]
            },
            "Comparing Fractions": {
                3: ["compare and order unit fractions, and fractions with the same denominators"],
                5: ["compare and order fractions whose denominators are all multiples of the same number"],
                6: ["compare and order fractions, including fractions >1"]
            },
            "Comparing Decimals": {
                4: ["compare numbers with the same number of decimal places up to two decimal places"],
                5: ["read, write, order and compare numbers with up to three decimal places"],
                6: ["identify the value of each digit in numbers given to three decimal places"]
            },
            "Rounding Including Decimals": {
                4: ["round decimals with one decimal place to the nearest whole number"],
                5: ["round decimals with two decimal places to the nearest whole number and to one decimal place"],
                6: ["solve problems which require answers to be rounded to specified degrees of accuracy"]
            },
            "Equivalence (FDP)": {
                2: ["write simple fractions e.g. 1/2 of 6 = 3 and recognise the equivalence of 2/4 and 1/2"],
                3: ["recognise and show, using diagrams, equivalent fractions with small denominators"],
                4: ["recognise and show, using diagrams, families of common equivalent fractions", "recognise and write decimal equivalents of any number of tenths or hundredths", "recognise and write decimal equivalents to 1/4; 1/2; 3/4"],
                5: ["identify, name and write equivalent fractions of a given fraction", "read and write decimal numbers as fractions", "recognise and use thousandths", "recognise the per cent symbol (%) and understand that per cent relates to number of parts per hundred"],
                6: ["use common factors to simplify fractions; use common multiples to express fractions in the same denomination", "associate a fraction with division and calculate decimal fraction equivalents", "recall and use equivalences between simple fractions, decimals and percentages"]
            },
            "Add & Subtract Fractions": {
                3: ["add and subtract fractions with the same denominator within one whole"],
                4: ["add and subtract fractions with the same denominator"],
                5: ["add and subtract fractions with the same denominator and multiples of the same number", "recognise mixed numbers and improper fractions and convert from one form to the other"],
                6: ["add and subtract fractions with different denominators and mixed numbers, using the concept of equivalent fractions"]
            },
            "Multiply & Divide Fractions": {
                5: ["multiply proper fractions and mixed numbers by whole numbers, supported by materials and diagrams"],
                6: ["multiply simple pairs of proper fractions, writing the answer in its simplest form", "multiply one-digit numbers with up to two decimal places by whole numbers", "divide proper fractions by whole numbers"]
            },
            "Multiply & Divide Decimals": {
                4: ["find the effect of dividing a one- or two-digit number by 10 and 100, identifying the value of the digits"],
                6: ["multiply one-digit numbers with up to two decimal places by whole numbers", "multiply and divide numbers by 10, 100 and 1000 where the answers are up to three decimal places", "identify the value of each digit to three decimal places", "associate a fraction with division and calculate decimal fraction equivalents", "use written division methods in cases where the answer has up to two decimal places"]
            },
            "Problem Solving (FDP)": {
                3: ["solve problems that involve all of the above"],
                4: ["solve problems involving increasingly harder fractions to calculate quantities", "solve simple measure and money problems involving fractions and decimals"],
                5: ["solve problems involving numbers up to three decimal places", "solve problems which require knowing percentage and decimal equivalents"]
            },
            "Equations": {
                1: ["solve one-step problems using concrete objects and pictorial representations", "represent and use number bonds and related subtraction facts within 20"],
                2: ["solve missing number problems", "recall and use addition and subtraction facts to 20 fluently, and derive and use related facts up to 100"],
                3: ["solve problems, including missing number problems", "solve problems involving multiplication and division, including integer scaling"],
                6: ["find pairs of numbers that satisfy number sentences involving two unknowns", "enumerate all possibilities of combinations of two variables"]
            },
            "Formulae": {
                6: ["use simple formulae", "generate and describe linear number sequences", "express missing number problems algebraically"]
            },
            "Sequences": {
                2: ["order and arrange combinations of mathematical objects in patterns and sequences"]
            },
            "Comparing and Estimating": {
                1: ["compare, describe and solve practical problems for: lengths and heights, mass/weight, capacity and volume, time", "sequence events in chronological order using language"],
                2: ["compare and order lengths, mass, volume/capacity and record the results using >, < and =", "compare and sequence intervals of time"],
                3: ["compare durations of events", "estimate and read time with increasing accuracy to the nearest minute"],
                4: ["estimate, compare and calculate different measures, including money in pounds and pence"],
                5: ["calculate and compare the area of squares and rectangles", "estimate volume and capacity"]
            },
            "Measuring and Calculating": {
                1: ["measure and begin to record: lengths and heights, mass/weight, capacity and volume, time", "recognise and know the value of different denominations of coins and notes"],
                2: ["choose and use appropriate standard units to estimate and measure", "recognise and use symbols for pounds (¬£) and pence (p)", "find different combinations of coins that equal the same amounts of money", "solve simple problems involving addition and subtraction of money"],
                3: ["measure, compare, add and subtract: lengths, mass, volume/capacity", "measure the perimeter of simple 2-D shapes", "add and subtract amounts of money to give change"],
                4: ["estimate, compare and calculate different measures", "measure and calculate the perimeter of a rectilinear figure", "find the area of rectilinear shapes by counting squares"],
                5: ["use all four operations to solve problems involving measure using decimal notation", "measure and calculate the perimeter of composite rectilinear shapes", "calculate and compare the area of squares and rectangles", "recognise and use square numbers and cube numbers"]
            },
            "Telling the Time": {
                1: ["tell the time to the hour and half past the hour and draw the hands on a clock face"],
                2: ["tell and write the time to five minutes, including quarter past/to the hour"],
                3: ["tell and write the time from an analogue clock, including using Roman numerals from I to XII, and 12-hour and 24-hour clocks"],
                4: ["read, write and convert time between analogue and digital 12 and 24-hour clocks"]
            },
            "Converting": {
                3: ["know the number of seconds in a minute and the number of days in each month, year and leap year"],
                4: ["convert between different units of measure", "read, write and convert time between analogue and digital 12 and 24-hour clocks"],
                5: ["convert between different units of metric measure", "understand and use approximate equivalences between metric units and common imperial units"],
                6: ["solve problems involving the calculation and conversion of units of measure, using decimal notation up to three decimal places"]
            },
            "Identifying Shapes & Properties": {
                2: ["identify and describe the properties of 2-D shapes", "identify and describe the properties of 3-D shapes", "identify 2-D shapes on the surface of 3-D shapes"],
                5: ["identify 3-D shapes from 2-D representations"],
                6: ["recognise, describe and build simple 3-D shapes, including making nets", "illustrate and name parts of circles, including radius, diameter and circumference"]
            },
            "Drawing and Constructing": {
                3: ["draw 2-D shapes and make 3-D shapes using modelling materials"],
                4: ["complete a simple symmetric figure with respect to a specific line of symmetry"],
                5: ["draw given angles, and measure them in degrees"],
                6: ["draw 2-D shapes using given dimensions and angles", "recognise, describe and build simple 3-D shapes, including making nets"]
            },
            "Comparing and Classifying": {
                2: ["compare and sort common 2-D and 3-D shapes and everyday objects"],
                4: ["compare and classify geometric shapes, including quadrilaterals and triangles, based on their properties and sizes"],
                5: ["use the properties of rectangles to deduce related facts and find missing lengths and angles", "distinguish between regular and irregular polygons"],
                6: ["compare and classify geometric shapes based on their properties and sizes and find unknown angles"]
            },
            "Angles": {
                3: ["identify right angles, recognise that two right angles make a half-turn", "identify horizontal and vertical lines and pairs of perpendicular and parallel lines"],
                5: ["identify: angles at a point and one whole turn (total 360¬∞), angles at a point on a straight line (total 180¬∞), other multiples of 90¬∞"],
                6: ["find unknown angles in any triangles, quadrilaterals, and regular polygons", "recognise angles where they meet at a point, are on a straight line, or are vertically opposite"]
            },
            "Position, Direction & Movement": {
                4: ["describe movements between positions as translations", "plot specified points and draw sides to complete a given polygon"],
                6: ["describe positions on the full coordinate grid", "draw and translate simple shapes on the coordinate plane, and reflect them in the axes"]
            },
            "Pattern": {
                2: ["order and arrange combinations of mathematical objects in patterns and sequences"]
            },
            "Ratio and Proportion": {
                6: ["solve problems involving the relative sizes of two quantities", "solve problems involving the calculation of percentages", "solve problems involving similar shapes where the scale factor is known", "solve problems involving unequal sharing and grouping"]
            },
            "Interpreting, Constructing & Presenting Data": {
                2: ["interpret and construct simple pictograms, tally charts, block diagrams and simple tables", "ask and answer simple questions by counting the number of objects", "ask and answer questions about totalling and comparing categorical data"],
                3: ["interpret and present data using bar charts, pictograms and tables"],
                4: ["interpret and present discrete and continuous data using appropriate graphical methods"],
                5: ["complete, read and interpret information in tables, including timetables"],
                6: ["interpret and construct pie charts and line graphs and use these to solve problems"]
            },
            "Solving Problems": {
                3: ["solve one-step and two-step questions using information presented in scaled bar charts and pictograms and tables"],
                4: ["solve comparison, sum and difference problems using information presented in bar charts, pictograms, tables and other graphs"],
                5: ["solve comparison, sum and difference problems using information presented in a line graph"],
                6: ["calculate and interpret the mean as an average"]
            }
        };

        // Apply user progress FIRST so the level calculation sees completed pundexes
        applyUserProgress();
        
        // STEP 1: Find the max level to display based on progress across all missions
        // We want the HIGHEST level that contains a "next available pundex" for ANY mission
        // But we need to find each mission's "current frontier" first
        
        let maxDisplayLevel = 1; // Always show at least Level 1
        
        document.querySelectorAll('.mission-row').forEach(row => {
            const cells = row.querySelectorAll('.pundex-cell');
            let missionNextLevel = null;
            
            // Find the first level where this mission has work to do
            for (let index = 0; index < cells.length; index++) {
                const cell = cells[index];
                const level = index + 1;
                
                if (!cell.classList.contains('unavailable')) {
                    const completedCount = cell.querySelectorAll('.pundex.completed').length;
                    const totalPundex = cell.querySelectorAll('.pundex').length;
                    
                    if (completedCount > 0 && completedCount < totalPundex) {
                        // In progress - this level has the next pundex
                        missionNextLevel = level;
                        break;
                    } else if (completedCount === totalPundex && totalPundex > 0) {
                        // Complete - keep looking for next available level
                        continue;
                    } else if (completedCount === 0) {
                        // Not started - this level has the next pundex
                        missionNextLevel = level;
                        break;
                    }
                }
            }
            
            // Only count missions that have started OR are at Level 1
            // Don't count missions that haven't been touched and start at higher levels
            if (missionNextLevel !== null) {
                // Check if this mission has ANY progress
                let hasAnyProgress = false;
                cells.forEach(cell => {
                    if (cell.querySelectorAll('.pundex.completed').length > 0) {
                        hasAnyProgress = true;
                    }
                });
                
                // Only include this mission's next level if:
                // 1. The mission has some progress, OR
                // 2. The mission's next level is within current maxDisplayLevel
                if (hasAnyProgress && missionNextLevel > maxDisplayLevel) {
                    maxDisplayLevel = missionNextLevel;
                }
            }
        });

        console.log('Max display level:', maxDisplayLevel);
        // alert('Dynamic dashboard - Max level to show: ' + maxDisplayLevel);

        // STEP 2: Hide columns beyond maxDisplayLevel
        // Update column headers
        const colHeaders = document.querySelectorAll('.col-header');
        colHeaders.forEach((header, index) => {
            if (index > maxDisplayLevel) { // index 0 is mission column, 1-6 are levels
                header.style.display = 'none';
            }
        });

        // Update colgroup - set explicit widths
        const cols = document.querySelectorAll('colgroup col');
        cols.forEach((col, index) => {
            if (index > maxDisplayLevel) {
                col.style.display = 'none';
            } else if (index === 0) {
                col.style.width = '340px';
            } else {
                col.style.width = '120px';
            }
        });

        // Update hidden thead
        const thCells = document.querySelectorAll('.hidden-thead th');
        thCells.forEach((th, index) => {
            if (index > maxDisplayLevel) {
                th.style.display = 'none';
            }
        });

        // STEP 3: Process each row - hide cells beyond maxDisplayLevel and determine visibility
        document.querySelectorAll('tbody tr').forEach(row => {
            const cells = row.querySelectorAll('td');
            
            // For realm rows, update colspan
            if (row.classList.contains('realm-row')) {
                const td = row.querySelector('td');
                td.setAttribute('colspan', maxDisplayLevel + 1);
                return;
            }
            
            // For mission rows, hide extra cells and check if row should be visible
            if (row.classList.contains('mission-row')) {
                let hasVisibleModules = false;
                
                cells.forEach((cell, index) => {
                    if (index === 0) return; // Skip mission name column
                    
                    if (index > maxDisplayLevel) {
                        cell.style.display = 'none';
                    } else {
                        // Check if this level has modules (not unavailable)
                        const pundexCell = cell.querySelector('.pundex-cell');
                        if (pundexCell && !pundexCell.classList.contains('unavailable')) {
                            hasVisibleModules = true;
                        }
                    }
                });
                
                // Hide mission row if it has no modules in displayed levels
                if (!hasVisibleModules) {
                    row.style.display = 'none';
                }
            }
        });

        // STEP 4: Hide realm rows if all their missions are hidden
        document.querySelectorAll('.realm-row').forEach(realmRow => {
            let nextRow = realmRow.nextElementSibling;
            let hasVisibleMission = false;
            
            while (nextRow && !nextRow.classList.contains('realm-row')) {
                if (nextRow.classList.contains('mission-row') && nextRow.style.display !== 'none') {
                    hasVisibleMission = true;
                    break;
                }
                nextRow = nextRow.nextElementSibling;
            }
            
            if (!hasVisibleMission) {
                realmRow.style.display = 'none';
            }
        });

        // STEP 6: Apply tooltips to all pundex cells and identify current level
        document.querySelectorAll('.mission-row').forEach(row => {
            if (row.style.display === 'none') return; // Skip hidden rows
            
            const firstCell = row.querySelector('td:first-child');
            const missionName = firstCell.textContent.trim();
            const cells = row.querySelectorAll('.pundex-cell');
            let foundCurrentLevel = false;
            let currentLevelNum = null;
            
            cells.forEach((cell, index) => {
                const level = index + 1;
                if (level > maxDisplayLevel) return; // Skip hidden levels
                
                const modules = moduleData[missionName] && moduleData[missionName][level];
                
                // Add tooltip if modules exist and cell is not unavailable
                if (modules && modules.length > 0 && !cell.classList.contains('unavailable')) {
                    const tooltipText = modules.map((m, i) => `‚Ä¢ ${m}`).join('\n');
                    cell.setAttribute('data-tooltip', tooltipText);
                }
                
                // Determine if this is the current level (in progress)
                if (!foundCurrentLevel && !cell.classList.contains('unavailable')) {
                    const completedCount = cell.querySelectorAll('.pundex.completed').length;
                    const totalPundex = cell.querySelectorAll('.pundex').length;
                    
                    if (completedCount > 0 && completedCount < totalPundex) {
                        cell.classList.add('current-level');
                        foundCurrentLevel = true;
                        currentLevelNum = level;
                    } else if (completedCount === totalPundex && totalPundex > 0) {
                        // Complete, check next
                    } else if (completedCount === 0) {
                        cell.classList.add('current-level');
                        foundCurrentLevel = true;
                        currentLevelNum = level;
                    }
                }
                
                cell.dataset.mission = missionName;
                cell.dataset.level = level;
            });

            // Wrap mission name in div with span and launch button
            firstCell.innerHTML = `<div><span class="mission-name">${missionName}</span><button class="launch-btn" data-mission="${missionName}" data-level="${currentLevelNum || 1}">Launch</button></div>`;
        });

        // Add click handler for current-level cells (desktop only)
        const isDesktop = window.innerWidth > 1024;
        const isMobile = window.innerWidth <= 767;
        
        if (isDesktop) {
            document.querySelectorAll('.pundex-cell.current-level').forEach(cell => {
                cell.addEventListener('click', () => {
                    const mission = cell.dataset.mission;
                    const level = cell.dataset.level;
                    window.location.href = `Q_Server.html?mission=${encodeURIComponent(mission)}&level=${level}`;
                });
            });
        }
        
        // Mobile: Update thead labels to shorter versions and determine which 3 levels to show
        if (isMobile) {
            // Update thead labels to shorter versions
            const thead = document.querySelector('.hidden-thead');
            if (thead) {
                const ths = thead.querySelectorAll('th');
                if (ths[0]) ths[0].textContent = 'Mission';
                if (ths[1]) ths[1].textContent = 'L1';
                if (ths[2]) ths[2].textContent = 'L2';
                if (ths[3]) ths[3].textContent = 'L3';
            }
            
            // Find the lowest level where user hasn't completed all missions
            let startLevel = 1;
            const allMissionRows = document.querySelectorAll('.mission-row');
            
            // Check each level (1-6) to find the first incomplete one
            for (let level = 1; level <= 6; level++) {
                let allCompleteAtLevel = true;
                allMissionRows.forEach(row => {
                    const levelCell = row.querySelector(`td:nth-child(${level + 1}) .pundex-cell`);
                    if (levelCell && !levelCell.classList.contains('unavailable')) {
                        const completedCount = levelCell.querySelectorAll('.pundex.completed').length;
                        const totalPundex = levelCell.querySelectorAll('.pundex').length;
                        if (completedCount < totalPundex) {
                            allCompleteAtLevel = false;
                        }
                    }
                });
                
                if (!allCompleteAtLevel) {
                    startLevel = level;
                    break;
                }
            }
            
            // Ensure we show levels startLevel to startLevel+2, max level 6
            if (startLevel > 4) startLevel = 4; // Max start is 4 to show 4,5,6
            
            // Update mobile header labels
            const mobileHeader = document.getElementById('mobileTableHeader');
            const levelHeaders = mobileHeader.querySelectorAll('.level-header');
            levelHeaders.forEach((header, index) => {
                const levelNum = startLevel + index;
                header.textContent = `L${levelNum}`;
                header.dataset.level = levelNum;
            });
            
            // Show/hide appropriate level columns in table
            allMissionRows.forEach(row => {
                for (let level = 1; level <= 6; level++) {
                    const cell = row.querySelector(`td:nth-child(${level + 1})`);
                    if (cell) {
                        if (level >= startLevel && level < startLevel + 3) {
                            cell.classList.add('mobile-show-level');
                            cell.classList.remove('mobile-hide-level');
                        } else {
                            cell.classList.add('mobile-hide-level');
                            cell.classList.remove('mobile-show-level');
                        }
                    }
                }
            });
            
            // Also update realm rows
            document.querySelectorAll('.realm-row').forEach(row => {
                for (let level = 1; level <= 6; level++) {
                    const cell = row.querySelector(`td:nth-child(${level + 1})`);
                    if (cell) {
                        if (level >= startLevel && level < startLevel + 3) {
                            cell.classList.add('mobile-show-level');
                            cell.classList.remove('mobile-hide-level');
                        } else {
                            cell.classList.add('mobile-hide-level');
                            cell.classList.remove('mobile-show-level');
                        }
                    }
                }
            });
        }

        // Make mission cells clickable on all views (launch buttons are now hidden)
        document.querySelectorAll('.mission-row td:first-child').forEach(cell => {
            cell.addEventListener('click', (e) => {
                const btn = cell.querySelector('.launch-btn');
                if (btn) {
                    const mission = btn.dataset.mission;
                    const level = btn.dataset.level;
                    window.location.href = `Q_Server.html?mission=${encodeURIComponent(mission)}&level=${level}`;
                }
            });
        });

        // Create tooltip element
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.style.display = 'none';
        document.body.appendChild(tooltip);
        
        let activeTooltipCell = null;
        const isTouchDevice = window.innerWidth <= 1024; // Mobile and tablet
        
        function showTooltip(cell) {
            const tooltipText = cell.getAttribute('data-tooltip');
            if (!tooltipText) return;

            tooltip.textContent = tooltipText;
            tooltip.style.display = 'block';

            const cellRect = cell.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            
            // Calculate horizontal position (centered on cell)
            let left = cellRect.left + (cellRect.width / 2) - (tooltipRect.width / 2);
            // Keep tooltip within viewport horizontally
            if (left < 10) left = 10;
            if (left + tooltipRect.width > window.innerWidth - 10) {
                left = window.innerWidth - tooltipRect.width - 10;
            }
            tooltip.style.left = left + 'px';

            // Check if there's enough space above
            const spaceAbove = cellRect.top;

            if (spaceAbove >= tooltipRect.height + 15) {
                // Show above
                tooltip.style.top = (cellRect.top - tooltipRect.height - 8) + 'px';
                tooltip.className = 'tooltip above';
            } else {
                // Show below
                tooltip.style.top = (cellRect.bottom + 8) + 'px';
                tooltip.className = 'tooltip below';
            }
            
            activeTooltipCell = cell;
        }
        
        function hideTooltip() {
            tooltip.style.display = 'none';
            activeTooltipCell = null;
        }

        // Add handlers for tooltips
        document.querySelectorAll('.pundex-cell[data-tooltip]').forEach(cell => {
            // Desktop: hover behavior
            cell.addEventListener('mouseenter', (e) => {
                if (!isTouchDevice) {
                    showTooltip(cell);
                }
            });

            cell.addEventListener('mouseleave', () => {
                if (!isTouchDevice) {
                    hideTooltip();
                }
            });
            
            // Mobile/Tablet: tap to show, tap again to close
            cell.addEventListener('click', (e) => {
                if (isTouchDevice) {
                    e.stopPropagation();
                    if (activeTooltipCell === cell) {
                        // Tap on same cell - hide tooltip
                        hideTooltip();
                    } else {
                        // Tap on different cell - show tooltip
                        showTooltip(cell);
                    }
                }
            });
        });
        
        // Close tooltip when tapping elsewhere on mobile/tablet
        if (isTouchDevice) {
            document.addEventListener('click', (e) => {
                if (activeTooltipCell && !e.target.closest('.pundex-cell') && !e.target.closest('.tooltip')) {
                    hideTooltip();
                }
            });
            
            // Also close when tapping the tooltip itself
            tooltip.addEventListener('click', () => {
                hideTooltip();
            });
        }

        // Sticky realm indicator logic
        const stickyIndicator = document.getElementById('stickyRealmIndicator');
        const stickyHeader = document.querySelector('.sticky-header');
        const table = document.querySelector('table');
        
        function updateStickyRealm() {
            const headerBottom = stickyHeader.getBoundingClientRect().bottom;
            const tableRect = table.getBoundingClientRect();
            let currentRealm = null;
            
            // Get all realm rows fresh each time (they're hidden by CSS but still in DOM)
            const realmRows = document.querySelectorAll('.realm-row');
            
            // Find the current realm based on which mission rows are visible
            // Look at mission rows and find which realm they belong to
            const missionRows = document.querySelectorAll('.mission-row');
            
            missionRows.forEach(row => {
                const rect = row.getBoundingClientRect();
                // If this mission row is at or above the sticky indicator position
                if (rect.top <= headerBottom + 60 && rect.bottom > headerBottom) {
                    // Find the realm row that precedes this mission
                    let prevSibling = row.previousElementSibling;
                    while (prevSibling) {
                        if (prevSibling.classList.contains('realm-row')) {
                            currentRealm = prevSibling.querySelector('td').textContent;
                            break;
                        }
                        prevSibling = prevSibling.previousElementSibling;
                    }
                }
            });
            
            // If no current realm found yet, use the first realm
            if (!currentRealm && realmRows.length > 0) {
                currentRealm = realmRows[0].querySelector('td').textContent;
            }
            
            // Always show the sticky indicator with current realm
            if (currentRealm) {
                stickyIndicator.textContent = currentRealm;
                stickyIndicator.style.left = tableRect.left + 'px';
                stickyIndicator.style.width = tableRect.width + 'px';
                stickyIndicator.style.top = (headerBottom) + 'px';
                stickyIndicator.classList.add('visible');
            }
        }
        
        window.addEventListener('scroll', updateStickyRealm);
        window.addEventListener('resize', updateStickyRealm);
        // Run after a short delay to ensure page is fully loaded
        setTimeout(updateStickyRealm, 100);
    </script>
</body>
</html>
