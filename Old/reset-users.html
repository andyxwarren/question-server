<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Users</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #111;
            color: #0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: #222;
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        h1 { color: #f0f; margin-bottom: 20px; }
        .user-list {
            text-align: left;
            margin: 20px 0;
            padding: 15px;
            background: #333;
            border-radius: 5px;
        }
        .user-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 10px;
            border-bottom: 1px solid #444;
            transition: background 0.2s;
        }
        .user-item:hover { background: rgba(0, 255, 0, 0.1); }
        .user-item:last-child { border-bottom: none; }
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .user-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #0f0;
        }
        .user-details {
            text-align: left;
        }
        .user-name {
            font-weight: 600;
            color: #0f0;
        }
        .user-meta {
            font-size: 12px;
            color: #888;
            margin-top: 2px;
        }
        .delete-single-btn {
            background: #e53935;
            color: white;
            border: none;
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-single-btn:hover { background: #c62828; }
        .button-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        button {
            background: #e53935;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #c62828; }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        button.secondary {
            background: #1e88e5;
        }
        button.secondary:hover { background: #1565c0; }
        button.warning {
            background: #ff9800;
        }
        button.warning:hover { background: #f57c00; }
        .success { color: #4caf50; margin-top: 15px; }
        .info { color: #0ff; font-size: 14px; margin-top: 10px; }
        .no-users {
            padding: 20px;
            color: #888;
            text-align: center;
        }
        .select-all-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-bottom: 2px solid #0f0;
            margin-bottom: 5px;
        }
        .select-all-row label {
            cursor: pointer;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üë• Manage Users</h1>
        <p>Select users to delete or manage individually.</p>
        
        <div class="user-list" id="userList">
            <div id="users"></div>
        </div>
        
        <div class="button-row">
            <button id="deleteSelectedBtn" onclick="deleteSelected()" disabled>Delete Selected (0)</button>
            <button class="warning" onclick="deleteAll()">Delete All</button>
            <button class="secondary" onclick="window.location.href='index.html'">Go to Login</button>
        </div>
        
        <div id="message"></div>
        <p class="info">üí° Tip: Check users to select, then click Delete Selected</p>
    </div>

    <script>
        let selectedUsers = new Set();
        
        function loadUsers() {
            const users = localStorage.getItem('questionApp_users');
            const userList = users ? JSON.parse(users) : [];
            const container = document.getElementById('users');
            selectedUsers.clear();
            updateDeleteButton();
            
            if (userList.length === 0) {
                container.innerHTML = '<div class="no-users">No users found</div>';
            } else {
                let html = `
                    <div class="select-all-row">
                        <input type="checkbox" id="selectAll" class="user-checkbox" onchange="toggleSelectAll(this)">
                        <label for="selectAll">Select All (${userList.length} users)</label>
                    </div>
                `;
                
                html += userList.map(u => `
                    <div class="user-item" data-user-id="${u.id}">
                        <div class="user-info">
                            <input type="checkbox" class="user-checkbox" value="${u.id}" onchange="toggleUser('${u.id}', this)">
                            <div class="user-details">
                                <div class="user-name">üë§ ${u.firstName} ${u.lastName}</div>
                                <div class="user-meta">Year ${u.yearGroup} ‚Ä¢ ID: ${u.id.substring(0, 8)}...</div>
                            </div>
                        </div>
                        <button class="delete-single-btn" onclick="deleteSingleUser('${u.id}')">üóëÔ∏è Delete</button>
                    </div>
                `).join('');
                
                container.innerHTML = html;
            }
        }
        
        function toggleUser(userId, checkbox) {
            if (checkbox.checked) {
                selectedUsers.add(userId);
            } else {
                selectedUsers.delete(userId);
            }
            updateDeleteButton();
            updateSelectAllCheckbox();
        }
        
        function toggleSelectAll(checkbox) {
            const users = localStorage.getItem('questionApp_users');
            const userList = users ? JSON.parse(users) : [];
            const checkboxes = document.querySelectorAll('.user-item .user-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
                if (checkbox.checked) {
                    selectedUsers.add(cb.value);
                } else {
                    selectedUsers.delete(cb.value);
                }
            });
            updateDeleteButton();
        }
        
        function updateSelectAllCheckbox() {
            const users = localStorage.getItem('questionApp_users');
            const userList = users ? JSON.parse(users) : [];
            const selectAll = document.getElementById('selectAll');
            if (selectAll) {
                selectAll.checked = selectedUsers.size === userList.length && userList.length > 0;
            }
        }
        
        function updateDeleteButton() {
            const btn = document.getElementById('deleteSelectedBtn');
            btn.textContent = `Delete Selected (${selectedUsers.size})`;
            btn.disabled = selectedUsers.size === 0;
        }
        
        function deleteSingleUser(userId) {
            const users = localStorage.getItem('questionApp_users');
            let userList = users ? JSON.parse(users) : [];
            const user = userList.find(u => u.id === userId);
            
            if (confirm(`Delete user "${user.firstName} ${user.lastName}"?`)) {
                userList = userList.filter(u => u.id !== userId);
                localStorage.setItem('questionApp_users', JSON.stringify(userList));
                
                // If deleted user was current user, log them out
                const currentUser = localStorage.getItem('questionApp_currentUser');
                if (currentUser) {
                    const current = JSON.parse(currentUser);
                    if (current.id === userId) {
                        localStorage.removeItem('questionApp_currentUser');
                    }
                }
                
                document.getElementById('message').innerHTML = 
                    `<div class="success">‚úÖ Deleted ${user.firstName} ${user.lastName}</div>`;
                loadUsers();
            }
        }
        
        function deleteSelected() {
            if (selectedUsers.size === 0) return;
            
            if (confirm(`Delete ${selectedUsers.size} selected user(s)?`)) {
                const users = localStorage.getItem('questionApp_users');
                let userList = users ? JSON.parse(users) : [];
                
                userList = userList.filter(u => !selectedUsers.has(u.id));
                localStorage.setItem('questionApp_users', JSON.stringify(userList));
                
                // If deleted user was current user, log them out
                const currentUser = localStorage.getItem('questionApp_currentUser');
                if (currentUser) {
                    const current = JSON.parse(currentUser);
                    if (selectedUsers.has(current.id)) {
                        localStorage.removeItem('questionApp_currentUser');
                    }
                }
                
                const count = selectedUsers.size;
                document.getElementById('message').innerHTML = 
                    `<div class="success">‚úÖ Deleted ${count} user(s)</div>`;
                loadUsers();
            }
        }
        
        function deleteAll() {
            const users = localStorage.getItem('questionApp_users');
            const userList = users ? JSON.parse(users) : [];
            
            if (userList.length === 0) {
                alert('No users to delete');
                return;
            }
            
            if (confirm(`Delete ALL ${userList.length} users and their data?`)) {
                localStorage.removeItem('questionApp_users');
                localStorage.removeItem('questionApp_currentUser');
                
                document.getElementById('message').innerHTML = 
                    '<div class="success">‚úÖ All users and data have been deleted!</div>';
                loadUsers();
            }
        }
        
        // Load users on page load
        loadUsers();
    </script>
</body>
</html>
